---
layout: default
title: Blog Admin
permalink: /blog/admin/
---

<div id="login-screen" class="login-container">
  <div class="login-box">
    <h1>Blog Admin</h1>
    <form id="login-form">
      <div class="form-group">
        <label for="admin-password">Password</label>
        <input type="password" id="admin-password" required>
      </div>
      <button type="submit" class="primary-btn">Login</button>
    </form>
    <div id="login-error" class="error-message" style="display: none;"></div>
  </div>
</div>

<div id="admin-app" style="display: none;">
  <div class="admin-header">
    <div class="header-top">
      <button id="back-to-blog-btn" class="back-btn">‚Üê Back to Blog</button>
    </div>
    <h1>Blog Admin</h1>
    <div class="header-actions">
      <button id="new-post-btn" class="primary-btn">New Post</button>
      <button id="deploy-btn" class="deploy-btn">üöÄ Deploy to GitHub</button>
      <button id="git-status-btn" class="secondary-btn">Git Status</button>
      <button id="logout-btn" class="secondary-btn">Logout</button>
    </div>
  </div>

  <div class="admin-tabs">
    <button class="tab-btn active" data-tab="published">Published</button>
    <button class="tab-btn" data-tab="drafts">Drafts</button>
  </div>

  <div class="admin-content">
    <div id="published-tab" class="tab-content active">
      <div id="published-posts" class="posts-list"></div>
    </div>
    <div id="drafts-tab" class="tab-content">
      <div id="draft-posts" class="posts-list"></div>
    </div>
  </div>

  <!-- Post Editor Modal -->
  <div id="post-editor" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="editor-title">New Post</h2>
        <button id="close-editor" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="editor-tabs">
          <button type="button" id="edit-tab-btn" class="editor-tab-btn active">Edit</button>
          <button type="button" id="preview-tab-btn" class="editor-tab-btn">Preview</button>
        </div>

        <div id="edit-view" class="editor-view active">
          <form id="post-form">
            <div class="form-group">
              <label for="post-title">Title</label>
              <input type="text" id="post-title" required>
            </div>
          
          <div class="form-group">
            <label for="post-slug">Slug (Filename & URL)</label>
            <input type="text" id="post-slug" placeholder="auto-generated">
            <div id="slug-preview" class="slug-preview"></div>
          </div>
          
          <div class="form-group">
            <label for="post-date">Date</label>
            <input type="date" id="post-date">
          </div>
          
          <div class="form-group">
            <label for="post-cover">Cover Image URL (optional)</label>
            <input type="url" id="post-cover" placeholder="https://...">
          </div>
          
          <div class="form-group">
            <label for="post-content">Content</label>
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" data-action="bold">B</button>
              <button type="button" class="toolbar-btn" data-action="italic">I</button>
              <button type="button" class="toolbar-btn" data-action="link">üîó</button>
              <button type="button" class="toolbar-btn" data-action="image">üñºÔ∏è</button>
              <span class="toolbar-info">Paste images & links directly in the editor</span>
            </div>
            <textarea id="post-content" rows="20" placeholder="Write your post in Markdown... You can paste images and links directly here!"></textarea>
          </div>
          
            <div class="form-actions">
              <button type="button" id="save-draft-btn" class="secondary-btn">Save Draft</button>
              <button type="button" id="publish-btn" class="primary-btn">Publish</button>
            </div>
          </form>
        </div>

        <div id="preview-view" class="editor-view">
          <div class="preview-container">
            <div class="preview-post">
              <h1 id="preview-title">Post Title</h1>
              <div class="preview-meta">
                <span id="preview-date">Date</span>
                <span id="preview-slug">‚Ä¢ Slug</span>
              </div>
              <div id="preview-cover"></div>
              <div id="preview-content" class="preview-content">
                Start writing to see your preview...
              </div>
            </div>
          </div>
          <div class="preview-actions">
            <button type="button" id="save-draft-preview-btn" class="secondary-btn">Save Draft</button>
            <button type="button" id="publish-preview-btn" class="primary-btn">Publish</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 60vh;
}

.login-box {
  background: white;
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 400px;
  text-align: center;
}

.login-box h1 {
  margin-bottom: 1.5rem;
  color: #333;
}

.admin-header {
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid #eee;
}

.header-top {
  margin-bottom: 1rem;
}

.back-btn {
  background: #f8f9fa;
  color: #6c757d;
  border: 1px solid #dee2e6;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.2s;
}

.back-btn:hover {
  background: #e9ecef;
  color: #495057;
  text-decoration: none;
}

.admin-header h1 {
  margin: 0 0 1rem 0;
}

.header-actions {
  display: flex;
  gap: 1rem;
}

.admin-tabs {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
  border-bottom: 1px solid #ddd;
}

.tab-btn {
  padding: 0.5rem 1rem;
  border: none;
  background: none;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  font-size: 1rem;
}

.tab-btn.active {
  border-bottom-color: #007acc;
  color: #007acc;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.posts-list {
  display: grid;
  gap: 1rem;
}

.post-item {
  padding: 1rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.post-info h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.1rem;
}

.post-info .meta {
  color: #666;
  font-size: 0.9rem;
}

.post-actions {
  display: flex;
  gap: 0.5rem;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
}

.modal-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  width: 90%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
  border-radius: 8px;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-bottom: 1px solid #ddd;
}

.modal-body {
  padding: 1rem;
}

.form-group {
  margin-bottom: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: bold;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-family: inherit;
}

.form-group textarea {
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  resize: vertical;
}

.editor-toolbar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0.5rem;
  background: #f8f9fa;
  border: 1px solid #ddd;
  border-radius: 4px 4px 0 0;
}

.toolbar-btn {
  background: white;
  border: 1px solid #ddd;
  border-radius: 3px;
  padding: 0.25rem 0.5rem;
  cursor: pointer;
  font-weight: bold;
  min-width: 2rem;
  height: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.toolbar-btn:hover {
  background: #e9ecef;
}

.toolbar-btn:active {
  background: #dee2e6;
}

.toolbar-info {
  margin-left: auto;
  font-size: 0.8rem;
  color: #666;
  font-style: italic;
}

#post-content {
  border-radius: 0 0 4px 4px !important;
  border-top: none !important;
}

.editor-tabs {
  display: flex;
  gap: 0;
  margin-bottom: 1rem;
  border-bottom: 1px solid #ddd;
}

.editor-tab-btn {
  background: #f8f9fa;
  border: 1px solid #ddd;
  border-bottom: none;
  padding: 0.75rem 1.5rem;
  cursor: pointer;
  font-size: 1rem;
  border-radius: 4px 4px 0 0;
  transition: all 0.2s;
}

.editor-tab-btn:hover {
  background: #e9ecef;
}

.editor-tab-btn.active {
  background: white;
  border-bottom: 1px solid white;
  margin-bottom: -1px;
  position: relative;
  z-index: 1;
}

.editor-view {
  display: none;
}

.editor-view.active {
  display: block;
}

.preview-container {
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 2rem;
  background: white;
  max-height: 60vh;
  overflow-y: auto;
  margin-bottom: 1rem;
}

.preview-post {
  max-width: 800px;
  margin: 0 auto;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
}

.preview-post h1 {
  font-size: 2.2rem;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0 0 0.5rem 0;
  line-height: 1.2;
}

.preview-meta {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #eee;
}

.preview-content {
  font-size: 1rem;
  color: #333;
  line-height: 1.7;
}

.preview-content h1 {
  font-size: 1.8rem;
  margin: 2rem 0 1rem 0;
  color: #1a1a1a;
}

.preview-content h2 {
  font-size: 1.5rem;
  margin: 1.8rem 0 0.8rem 0;
  color: #1a1a1a;
}

.preview-content h3 {
  font-size: 1.3rem;
  margin: 1.5rem 0 0.5rem 0;
  color: #1a1a1a;
}

.preview-content p {
  margin: 1rem 0;
}

.preview-content a {
  color: #007acc;
  text-decoration: none;
}

.preview-content a:hover {
  text-decoration: underline;
}

.preview-content img {
  max-width: 100%;
  height: auto;
  margin: 1rem 0;
  border-radius: 4px;
}

.preview-content blockquote {
  border-left: 4px solid #007acc;
  margin: 1.5rem 0;
  padding: 0.5rem 0 0.5rem 1rem;
  background: #f8f9fa;
  font-style: italic;
}

.preview-content ul, .preview-content ol {
  margin: 1rem 0;
  padding-left: 2rem;
}

.preview-content li {
  margin: 0.5rem 0;
}

.preview-content code {
  background: #f1f3f4;
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 0.9em;
}

.preview-content pre {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 4px;
  padding: 1rem;
  overflow-x: auto;
  margin: 1rem 0;
}

.preview-content pre code {
  background: none;
  padding: 0;
}

.preview-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.slug-preview {
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: #f8f9fa;
  border-radius: 4px;
  font-size: 0.9rem;
  color: #666;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
}

.slug-preview strong {
  color: #333;
}

.form-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 2rem;
}

.primary-btn {
  background: #007acc;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

.secondary-btn {
  background: #f5f5f5;
  color: #333;
  border: 1px solid #ddd;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

.deploy-btn {
  background: #28a745;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.deploy-btn:hover {
  background: #218838;
}

.deploy-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
}

.btn-small {
  padding: 0.25rem 0.5rem;
  font-size: 0.8rem;
}

.close-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #666;
}

.empty-state {
  text-align: center;
  color: #666;
  font-style: italic;
  padding: 2rem;
}
</style>

<script>
class BlogAdmin {
  constructor() {
    this.posts = [];
    this.drafts = [];
    this.currentPost = null;
    this.apiUrl = 'http://localhost:3001/api';
    this.adminPassword = 'blog2025!'; // Change this password!
    this.isAuthenticated = false;
    this.init();
  }

  init() {
    this.checkAuth();
    this.bindEvents();
  }

  checkAuth() {
    const stored = localStorage.getItem('blogAdminAuth');
    if (stored === this.adminPassword) {
      this.isAuthenticated = true;
      this.showAdmin();
    } else {
      this.showLogin();
    }
  }

  showLogin() {
    document.getElementById('login-screen').style.display = 'block';
    document.getElementById('admin-app').style.display = 'none';
  }

  showAdmin() {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('admin-app').style.display = 'block';
    if (this.isAuthenticated) {
      this.loadPosts();
      this.loadDrafts();
    }
  }

  bindEvents() {
    // Login form
    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      this.handleLogin();
    });

    // Back to blog button
    document.getElementById('back-to-blog-btn').addEventListener('click', () => {
      window.location.href = '/blog/';
    });

    // Deploy button
    document.getElementById('deploy-btn').addEventListener('click', () => {
      this.deployToGitHub();
    });

    // Git status button
    document.getElementById('git-status-btn').addEventListener('click', () => {
      this.showGitStatus();
    });

    // Logout button
    document.getElementById('logout-btn').addEventListener('click', () => {
      this.logout();
    });

    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const tab = e.target.dataset.tab;
        this.switchTab(tab);
      });
    });

    // New post button
    document.getElementById('new-post-btn').addEventListener('click', () => {
      this.openEditor();
    });

    // Close editor
    document.getElementById('close-editor').addEventListener('click', () => {
      this.closeEditor();
    });

    // Modal backdrop click
    document.getElementById('post-editor').addEventListener('click', (e) => {
      if (e.target.id === 'post-editor') {
        this.closeEditor();
      }
    });

    // Form actions
    document.getElementById('save-draft-btn').addEventListener('click', () => {
      this.saveDraft();
    });

    document.getElementById('publish-btn').addEventListener('click', () => {
      this.publishPost();
    });

    // Auto-generate slug from title (this will be the filename)
    document.getElementById('post-title').addEventListener('input', (e) => {
      if (!this.currentPost) {
        const slug = this.generateSlug(e.target.value);
        document.getElementById('post-slug').value = slug;
        this.showSlugPreview(slug);
      }
    });

    document.getElementById('post-slug').addEventListener('input', (e) => {
      this.showSlugPreview(e.target.value);
    });

    // Set default date
    document.getElementById('post-date').value = new Date().toISOString().split('T')[0];

    // Toolbar buttons
    document.querySelectorAll('.toolbar-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const action = e.target.dataset.action;
        this.handleToolbarAction(action);
      });
    });

    // Rich text paste handling
    document.getElementById('post-content').addEventListener('paste', (e) => {
      this.handlePaste(e);
    });

    // URL detection while typing
    document.getElementById('post-content').addEventListener('input', (e) => {
      this.handleAutoFormat(e);
      this.updatePreview(); // Update preview as user types
    });

    // Editor tabs
    document.getElementById('edit-tab-btn').addEventListener('click', () => {
      this.switchEditorTab('edit');
    });

    document.getElementById('preview-tab-btn').addEventListener('click', () => {
      this.switchEditorTab('preview');
      this.updatePreview();
    });

    // Preview action buttons
    document.getElementById('save-draft-preview-btn').addEventListener('click', () => {
      this.saveDraft();
    });

    document.getElementById('publish-preview-btn').addEventListener('click', () => {
      this.publishPost();
    });

    // Update preview when form fields change
    document.getElementById('post-title').addEventListener('input', () => {
      this.updatePreview();
    });

    document.getElementById('post-date').addEventListener('change', () => {
      this.updatePreview();
    });

    document.getElementById('post-slug').addEventListener('input', () => {
      this.updatePreview();
    });

    document.getElementById('post-cover').addEventListener('input', () => {
      this.updatePreview();
    });
  }

  handleLogin() {
    const password = document.getElementById('admin-password').value;
    const errorDiv = document.getElementById('login-error');
    
    if (password === this.adminPassword) {
      localStorage.setItem('blogAdminAuth', password);
      this.isAuthenticated = true;
      this.showAdmin();
    } else {
      errorDiv.textContent = 'Incorrect password';
      errorDiv.style.display = 'block';
      document.getElementById('admin-password').value = '';
    }
  }

  logout() {
    localStorage.removeItem('blogAdminAuth');
    this.isAuthenticated = false;
    this.showLogin();
  }

  async deployToGitHub() {
    const deployBtn = document.getElementById('deploy-btn');
    const originalText = deployBtn.innerHTML;
    
    // Disable button and show loading state
    deployBtn.disabled = true;
    deployBtn.innerHTML = '‚è≥ Deploying...';
    
    try {
      const response = await fetch(`${this.apiUrl}/deploy`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        const result = await response.json();
        deployBtn.innerHTML = '‚úÖ Deployed!';
        
        if (result.alreadyUpToDate) {
          this.showMessage('No changes to deploy - everything is up to date!');
        } else {
          this.showMessage('Successfully deployed to GitHub! Your changes will be live in a few minutes.');
        }
        
        // Reset button after 3 seconds
        setTimeout(() => {
          deployBtn.disabled = false;
          deployBtn.innerHTML = originalText;
        }, 3000);
      } else {
        const error = await response.json();
        throw new Error(error.error || 'Deployment failed');
      }
    } catch (error) {
      console.error('Deployment error:', error);
      deployBtn.innerHTML = '‚ùå Failed';
      
      // Show error with manual instructions if needed
      if (error.message.includes('Username for') || error.message.includes('authentication') || error.message.includes('Deployment failed')) {
        this.showGitStatusModal('Deploy Failed - Manual Steps Required', `
          <p><strong>Authentication required.</strong> Please run these commands in your terminal:</p>
          <pre>git push origin main</pre>
          <p>Or set up Git authentication with one of these methods:</p>
          <ul>
            <li><strong>Personal Access Token:</strong> git config --global credential.helper store</li>
            <li><strong>SSH:</strong> Use git@github.com:adamtpang/adampang.com.git as remote</li>
            <li><strong>GitHub CLI:</strong> gh auth login</li>
          </ul>
        `);
      } else {
        this.showError(`Deployment failed: ${error.message}`);
      }
      
      // Reset button after 3 seconds
      setTimeout(() => {
        deployBtn.disabled = false;
        deployBtn.innerHTML = originalText;
      }, 3000);
    }
  }

  async showGitStatus() {
    try {
      const response = await fetch(`${this.apiUrl}/git-status`);
      if (response.ok) {
        const result = await response.json();
        this.showGitStatusModal('Git Status', result.statusHtml);
      } else {
        this.showError('Failed to get Git status');
      }
    } catch (error) {
      this.showError('Error getting Git status');
    }
  }

  showGitStatusModal(title, content) {
    // Create modal
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2>${title}</h2>
          <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
        </div>
        <div class="modal-body">
          ${content}
        </div>
      </div>
    `;
    
    // Add to page
    document.body.appendChild(modal);
    
    // Close on backdrop click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.remove();
      }
    });
  }

  handleToolbarAction(action) {
    const textarea = document.getElementById('post-content');
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    let newText = '';

    switch (action) {
      case 'bold':
        newText = selectedText ? `**${selectedText}**` : '**bold text**';
        break;
      case 'italic':
        newText = selectedText ? `*${selectedText}*` : '*italic text*';
        break;
      case 'link':
        const linkText = selectedText || 'link text';
        newText = `[${linkText}](https://example.com)`;
        break;
      case 'image':
        const altText = selectedText || 'image description';
        newText = `![${altText}](https://example.com/image.jpg)`;
        break;
    }

    if (newText) {
      this.insertTextAtCursor(textarea, newText, start, end);
    }
  }

  handlePaste(e) {
    const items = e.clipboardData.items;
    let hasImage = false;
    let hasText = false;

    // Check what's being pasted
    for (let item of items) {
      if (item.type.indexOf('image') !== -1) {
        hasImage = true;
        this.handleImagePaste(item);
        e.preventDefault();
        return;
      }
      if (item.type === 'text/plain') {
        hasText = true;
      }
    }

    // Handle text paste with URL detection
    if (hasText && !hasImage) {
      e.preventDefault();
      const text = e.clipboardData.getData('text/plain');
      this.handleTextPaste(text);
    }
  }

  handleImagePaste(item) {
    const file = item.getAsFile();
    if (file) {
      // Create a file reader to get base64
      const reader = new FileReader();
      reader.onload = (e) => {
        const base64 = e.target.result;
        const textarea = document.getElementById('post-content');
        const imageMarkdown = `![Pasted image](${base64})`;
        
        // Insert at cursor position
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        this.insertTextAtCursor(textarea, imageMarkdown, start, end);
        
        // Show helpful message
        this.showMessage('Image pasted! Consider uploading to your assets folder and replacing the base64 with a proper URL.');
      };
      reader.readAsDataURL(file);
    }
  }

  handleTextPaste(text) {
    const textarea = document.getElementById('post-content');
    let processedText = text;

    // Detect URLs and convert to markdown links
    const urlRegex = /(https?:\/\/[^\s]+)/g;
    const urls = text.match(urlRegex);
    
    if (urls && urls.length > 0) {
      for (let url of urls) {
        // Try to create a meaningful link text from the URL
        let linkText = url;
        try {
          const urlObj = new URL(url);
          linkText = urlObj.hostname.replace('www.', '');
        } catch (e) {
          // Keep original URL as link text if parsing fails
        }
        
        processedText = processedText.replace(url, `[${linkText}](${url})`);
      }
      
      this.showMessage('URLs automatically converted to markdown links!');
    }

    // Insert processed text at cursor position
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    this.insertTextAtCursor(textarea, processedText, start, end);
  }

  handleAutoFormat(e) {
    // This could be expanded for real-time formatting
    // For now, just basic cleanup
  }

  insertTextAtCursor(textarea, text, start, end) {
    const beforeCursor = textarea.value.substring(0, start);
    const afterCursor = textarea.value.substring(end);
    
    textarea.value = beforeCursor + text + afterCursor;
    
    // Set cursor position after inserted text
    const newCursorPos = start + text.length;
    textarea.setSelectionRange(newCursorPos, newCursorPos);
    textarea.focus();
  }

  showMessage(message) {
    // Create and show a temporary message
    const messageDiv = document.createElement('div');
    messageDiv.className = 'success-message';
    messageDiv.style.cssText = 'background: #d4edda; color: #155724; padding: 0.5rem; margin: 0.5rem 0; border-radius: 4px; border: 1px solid #c3e6cb; font-size: 0.9rem;';
    messageDiv.textContent = message;
    
    const contentGroup = document.querySelector('#post-content').parentNode;
    contentGroup.insertBefore(messageDiv, document.querySelector('#post-content'));
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
      if (messageDiv.parentNode) {
        messageDiv.parentNode.removeChild(messageDiv);
      }
    }, 3000);
  }

  showSlugPreview(slug) {
    const previewDiv = document.getElementById('slug-preview');
    if (slug) {
      previewDiv.innerHTML = `
        <strong>Filename:</strong> ${slug}.md<br>
        <strong>URL:</strong> adampang.com/${slug}
      `;
    } else {
      previewDiv.innerHTML = '';
    }
  }

  switchEditorTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.editor-tab-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    document.getElementById(`${tab}-tab-btn`).classList.add('active');

    // Update tab content
    document.querySelectorAll('.editor-view').forEach(view => {
      view.classList.remove('active');
    });
    document.getElementById(`${tab}-view`).classList.add('active');
  }

  updatePreview() {
    const title = document.getElementById('post-title').value || 'Untitled Post';
    const content = document.getElementById('post-content').value;
    const date = document.getElementById('post-date').value;
    const slug = document.getElementById('post-slug').value;
    const coverImage = document.getElementById('post-cover').value;

    // Update preview elements
    document.getElementById('preview-title').textContent = title;
    document.getElementById('preview-date').textContent = date || 'No date';
    document.getElementById('preview-slug').textContent = `‚Ä¢ ${slug || 'no-slug'}`;

    // Handle cover image
    const coverDiv = document.getElementById('preview-cover');
    if (coverImage) {
      coverDiv.innerHTML = `<img src="${coverImage}" alt="Cover image" style="width: 100%; max-height: 300px; object-fit: cover; margin-bottom: 2rem; border-radius: 4px;">`;
    } else {
      coverDiv.innerHTML = '';
    }

    // Convert markdown to HTML and update content
    const htmlContent = this.markdownToHtml(content);
    document.getElementById('preview-content').innerHTML = htmlContent || '<p style="color: #666; font-style: italic;">Start writing to see your preview...</p>';
  }

  markdownToHtml(markdown) {
    if (!markdown) return '';

    let html = markdown;

    // Headers
    html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
    html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
    html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');

    // Bold and italic
    html = html.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>');
    html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');

    // Links
    html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

    // Images
    html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');

    // Code blocks
    html = html.replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>');
    
    // Inline code
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

    // Blockquotes
    html = html.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');

    // Line breaks and paragraphs
    html = html.replace(/\n\n/g, '</p><p>');
    html = html.replace(/\n/g, '<br>');
    
    // Wrap in paragraphs if content exists
    if (html.trim()) {
      html = '<p>' + html + '</p>';
      
      // Clean up empty paragraphs
      html = html.replace(/<p><\/p>/g, '');
      html = html.replace(/<p>(<h[1-6]>)/g, '$1');
      html = html.replace(/(<\/h[1-6]>)<\/p>/g, '$1');
      html = html.replace(/<p>(<blockquote>)/g, '$1');
      html = html.replace(/(<\/blockquote>)<\/p>/g, '$1');
      html = html.replace(/<p>(<pre>)/g, '$1');
      html = html.replace(/(<\/pre>)<\/p>/g, '$1');
    }

    // Handle lists (basic)
    html = html.replace(/^[\*\-\+] (.+)$/gm, '<li>$1</li>');
    html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
    
    // Handle numbered lists
    html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
    
    return html;
  }

  generateSlug(title) {
    return title
      .toLowerCase()
      .replace(/[^\w\s-]/g, '')
      .replace(/[\s_-]+/g, '-')
      .replace(/^-+|-+$/g, '');
  }

  switchTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

    // Update tab content
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.remove('active');
    });
    document.getElementById(`${tab}-tab`).classList.add('active');
  }

  async loadPosts() {
    try {
      const response = await fetch(`${this.apiUrl}/posts`);
      if (response.ok) {
        this.posts = await response.json();
        this.renderPosts();
      } else {
        console.error('Failed to load posts');
        this.showError('Failed to load posts');
      }
    } catch (error) {
      console.error('Error loading posts:', error);
      this.showError('Error connecting to blog API. Make sure the server is running.');
    }
  }

  async loadDrafts() {
    try {
      const response = await fetch(`${this.apiUrl}/drafts`);
      if (response.ok) {
        this.drafts = await response.json();
        this.renderDrafts();
      } else {
        console.error('Failed to load drafts');
        this.showError('Failed to load drafts');
      }
    } catch (error) {
      console.error('Error loading drafts:', error);
      this.showError('Error connecting to blog API. Make sure the server is running.');
    }
  }

  showError(message) {
    // Simple error display - you could make this more sophisticated
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.style.cssText = 'background: #f8d7da; color: #721c24; padding: 1rem; margin: 1rem 0; border-radius: 4px; border: 1px solid #f5c6cb;';
    errorDiv.textContent = message;
    
    const adminContent = document.querySelector('.admin-content');
    adminContent.insertBefore(errorDiv, adminContent.firstChild);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
      if (errorDiv.parentNode) {
        errorDiv.parentNode.removeChild(errorDiv);
      }
    }, 5000);
  }

  renderPosts() {
    const container = document.getElementById('published-posts');
    
    if (this.posts.length === 0) {
      container.innerHTML = '<div class="empty-state">No published posts yet.</div>';
      return;
    }

    container.innerHTML = this.posts.map(post => `
      <div class="post-item">
        <div class="post-info">
          <h3>${post.title}</h3>
          <div class="meta">${post.date} ‚Ä¢ ${post.slug}</div>
        </div>
        <div class="post-actions">
          <button class="secondary-btn btn-small" onclick="blogAdmin.previewPost('${post.filename}')">Preview</button>
          <button class="secondary-btn btn-small" onclick="blogAdmin.editPost('${post.filename}')">Edit</button>
          <button class="secondary-btn btn-small" onclick="blogAdmin.unpublishPost('${post.filename}')">Unpublish</button>
        </div>
      </div>
    `).join('');
  }

  renderDrafts() {
    const container = document.getElementById('draft-posts');
    
    if (this.drafts.length === 0) {
      container.innerHTML = '<div class="empty-state">No drafts yet.</div>';
      return;
    }

    container.innerHTML = this.drafts.map(draft => `
      <div class="post-item">
        <div class="post-info">
          <h3>${draft.title}</h3>
          <div class="meta">Draft</div>
        </div>
        <div class="post-actions">
          <button class="secondary-btn btn-small" onclick="blogAdmin.previewDraft('${draft.filename}')">Preview</button>
          <button class="secondary-btn btn-small" onclick="blogAdmin.editDraft('${draft.filename}')">Edit</button>
          <button class="primary-btn btn-small" onclick="blogAdmin.publishDraft('${draft.filename}')">Publish</button>
          <button class="secondary-btn btn-small" onclick="blogAdmin.deleteDraft('${draft.filename}')">Delete</button>
        </div>
      </div>
    `).join('');
  }

  openEditor(post = null) {
    this.currentPost = post;
    
    if (post) {
      document.getElementById('editor-title').textContent = 'Edit Post';
      document.getElementById('post-title').value = post.title;
      document.getElementById('post-slug').value = post.slug;
      document.getElementById('post-date').value = post.date;
      document.getElementById('post-cover').value = post.coverImage || '';
      document.getElementById('post-content').value = post.content;
      this.showSlugPreview(post.slug);
    } else {
      document.getElementById('editor-title').textContent = 'New Post';
      document.getElementById('post-form').reset();
      document.getElementById('post-date').value = new Date().toISOString().split('T')[0];
      document.getElementById('slug-preview').innerHTML = '';
    }

    // Switch to edit tab and update preview
    this.switchEditorTab('edit');
    this.updatePreview();
    document.getElementById('post-editor').style.display = 'block';
  }

  closeEditor() {
    document.getElementById('post-editor').style.display = 'none';
    this.currentPost = null;
  }

  async saveDraft() {
    const formData = this.getFormData();
    
    if (!formData.title.trim()) {
      alert('Title is required');
      return;
    }

    try {
      let response;
      
      if (this.currentPost && this.currentPost.isDraft) {
        // Update existing draft
        response = await fetch(`${this.apiUrl}/drafts/${this.currentPost.filename}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
      } else {
        // Create new draft
        response = await fetch(`${this.apiUrl}/drafts`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
      }

      if (response.ok) {
        const result = await response.json();
        alert(result.message || 'Draft saved successfully!');
        this.loadDrafts();
        this.closeEditor();
      } else {
        const error = await response.json();
        alert(error.error || 'Failed to save draft');
      }
    } catch (error) {
      console.error('Error saving draft:', error);
      alert('Error saving draft. Make sure the API server is running.');
    }
  }

  async publishPost() {
    const formData = this.getFormData();
    
    if (!formData.title.trim()) {
      alert('Title is required');
      return;
    }

    try {
      let response;
      
      if (this.currentPost && !this.currentPost.isDraft) {
        // Update existing post
        response = await fetch(`${this.apiUrl}/posts/${this.currentPost.filename}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
      } else {
        // Publish new post or from draft
        const publishData = { ...formData };
        if (this.currentPost && this.currentPost.isDraft) {
          publishData.fromDraft = { filename: this.currentPost.filename };
        }
        
        response = await fetch(`${this.apiUrl}/posts`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(publishData)
        });
      }

      if (response.ok) {
        const result = await response.json();
        alert(result.message || 'Post published successfully!');
        this.loadPosts();
        this.loadDrafts();
        this.closeEditor();
      } else {
        const error = await response.json();
        alert(error.error || 'Failed to publish post');
      }
    } catch (error) {
      console.error('Error publishing post:', error);
      alert('Error publishing post. Make sure the API server is running.');
    }
  }

  getFormData() {
    const slug = document.getElementById('post-slug').value;
    return {
      title: document.getElementById('post-title').value,
      slug: slug, // This will be used as the filename
      date: document.getElementById('post-date').value,
      coverImage: document.getElementById('post-cover').value,
      content: document.getElementById('post-content').value
    };
  }

  async editPost(filename) {
    try {
      const response = await fetch(`${this.apiUrl}/posts/${filename}`);
      if (response.ok) {
        const post = await response.json();
        post.isDraft = false;
        this.openEditor(post);
      } else {
        alert('Failed to load post');
      }
    } catch (error) {
      console.error('Error loading post:', error);
      alert('Error loading post');
    }
  }

  async editDraft(filename) {
    try {
      const response = await fetch(`${this.apiUrl}/drafts/${filename}`);
      if (response.ok) {
        const draft = await response.json();
        draft.isDraft = true;
        this.openEditor(draft);
      } else {
        alert('Failed to load draft');
      }
    } catch (error) {
      console.error('Error loading draft:', error);
      alert('Error loading draft');
    }
  }

  async unpublishPost(filename) {
    if (!confirm('Move this post to drafts?')) {
      return;
    }

    try {
      const response = await fetch(`${this.apiUrl}/posts/${filename}/unpublish`, {
        method: 'POST'
      });

      if (response.ok) {
        const result = await response.json();
        alert(result.message || 'Post moved to drafts');
        this.loadPosts();
        this.loadDrafts();
      } else {
        const error = await response.json();
        alert(error.error || 'Failed to unpublish post');
      }
    } catch (error) {
      console.error('Error unpublishing post:', error);
      alert('Error unpublishing post');
    }
  }

  async publishDraft(filename) {
    try {
      const response = await fetch(`${this.apiUrl}/drafts/${filename}`);
      if (response.ok) {
        const draft = await response.json();
        
        // Use the draft data to publish
        const publishData = {
          title: draft.title,
          content: draft.content,
          date: new Date().toISOString().split('T')[0],
          coverImage: draft.coverImage,
          fromDraft: { filename }
        };

        const publishResponse = await fetch(`${this.apiUrl}/posts`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(publishData)
        });

        if (publishResponse.ok) {
          const result = await publishResponse.json();
          alert(result.message || 'Draft published successfully!');
          this.loadPosts();
          this.loadDrafts();
        } else {
          const error = await publishResponse.json();
          alert(error.error || 'Failed to publish draft');
        }
      } else {
        alert('Failed to load draft');
      }
    } catch (error) {
      console.error('Error publishing draft:', error);
      alert('Error publishing draft');
    }
  }

  async deleteDraft(filename) {
    if (!confirm('Delete this draft permanently?')) {
      return;
    }

    try {
      const response = await fetch(`${this.apiUrl}/drafts/${filename}`, {
        method: 'DELETE'
      });

      if (response.ok) {
        const result = await response.json();
        alert(result.message || 'Draft deleted');
        this.loadDrafts();
      } else {
        const error = await response.json();
        alert(error.error || 'Failed to delete draft');
      }
    } catch (error) {
      console.error('Error deleting draft:', error);
      alert('Error deleting draft');
    }
  }
}

// Initialize the admin when page loads
let blogAdmin;
document.addEventListener('DOMContentLoaded', () => {
  blogAdmin = new BlogAdmin();
});
</script>